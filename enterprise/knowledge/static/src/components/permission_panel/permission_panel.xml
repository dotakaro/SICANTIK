<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="knowledge.PermissionPanel">
        <div class="o_knowledge_permission_panel px-3 py-2 gap-2 mw-100 overflow-y-auto">
            <div class="d-flex align-items-center py-1 knowledge_restriction_message" t-if="data.is_desynchronized and state.isArticleLoaded">
                <i class="fa fa-fw fa-shield fa-2x mx-1"/>
                <div class="flex-grow-1 px-3">
                    Access Restricted. <t t-if="parentArticle.id">May not be shared with everyone from</t>
                    <a t-if="parentArticle.id" class="ps-1" href="#" t-on-click="() => this.openArticle(parentArticle.id)" t-out="parentArticle.name"/>
                </div>
                <button t-if="userCanEdit" class="btn btn-link" t-on-click="restoreArticle">Restore</button>
            </div>
            <div class="o_internal_permission d-flex align-items-center py-1" t-if="userIsInternal and state.isArticleLoaded">
                <i class="fa fa-fw fa-building ms-1 fs-3"/>
                <div class="flex-grow-1 min-w-0 px-3">
                    <div class="text-truncate">Default Access Rights</div>
                    <div t-if="data.inherited_permission_parent_id" class="knowledge_internal_permission_based_on_text text-truncate text-muted">
                        Based on <a href="#" t-on-click="() => this.openArticle(this.inheritedPermissionParent.id)" t-out="inheritedPermissionParent.name"/>
                    </div>
                </div>
                <Dropdown menuClass="'d-flex flex-column min-w-0'">
                    <button class="btn bg-light border d-flex align-items-center fw-normal"
                            t-att-class="{
                                'disabled': !userCanEdit,
                                'o-dropdown-caret': userCanEdit,
                            }"
                            t-out="permissions[this.data.inherited_permission]"
                    />
                    <t t-set-slot="content">
                        <t t-foreach="permissions" t-as="permission" t-key="permission">
                            <DropdownItem onSelected="() => this.selectInternalPermission(permission)"
                                            class="{ 'flex-grow-1': true, active: permission === data.inherited_permission }"
                                            t-out="permission_value"
                            />
                        </t>
                    </t>
                </Dropdown>
            </div>
            <div t-if="userIsInternal and isRootArticle and data.inherited_permission !== 'none' and state.isArticleLoaded" class="o_internal_visibility d-flex align-items-center">
                <i class="fa fa-fw fa-eye ms-1 fs-3"/>
                <div class="flex-grow-1 px-3">Visibility</div>
                <Dropdown menuClass="'d-flex flex-column min-w-0'">
                    <button class="btn bg-light border d-flex align-items-center fw-normal"
                            t-att-class="{
                                'disabled': !userCanEdit,
                                'o-dropdown-caret': userCanEdit,
                            }"
                            t-out="visibilities[this.visibility]"
                    />
                    <t t-set-slot="content">
                        <t t-foreach="visibilities" t-as="visibilityValue" t-key="visibilityValue">
                            <DropdownItem onSelected="() => this.selectInternalVisibility(visibilityValue)"
                                            class="{ 'flex-grow-1': true, active: visibilityValue === this.visibility }"
                                            t-out="visibilityValue_value"
                            />
                        </t>
                    </t>
                </Dropdown>
            </div>
            <hr class="mx-n3 my-2" t-if="userIsInternal and state.isArticleLoaded"/>
            <div class="d-flex align-items-center py-1" t-if="userIsAdmin or (userCanEdit and userIsInternal)">
                <i class="fa fa-fw fa-user-plus ms-2 fs-3"/>
                <div t-on-click="openInviteDialog" class="input-group ps-3">
                    <span class="form-control text-truncate text-muted cursor-pointer">Add people or email addresses...</span>
                    <span class="btn btn-primary">Invite</span>
                </div>
            </div>
            <div class="py-3 text-center" t-if="!state.isArticleLoaded">
                <i class="fa fa-circle-o-notch fa-2x fa-spin"/>
            </div>
            <div t-if="members and state.isArticleLoaded" class="o_knowledge_permission_panel_members">
                <div class="d-flex align-items-center py-1" t-foreach="members"
                        t-as="member" t-key="member.id">
                    <t t-set="isUniqueWriter" t-value="hasUniqueWriter and member.canWrite"/>
                    <t t-set="noRightsEscalation"
                        t-value="member.isCurrentUser and (permissionLevel[member.permission] gte permissionLevel[data.inherited_permission] or userIsAdmin)"/>
                    <t t-set="canEditOtherMember"
                        t-value="!member.isCurrentUser and !isUniqueWriter and userCanEdit"/>
                    <div>
                        <img t-if="userIsInternal" class="rounded"
                                t-att-class="{'cursor-pointer': !member.partner_share}"
                                t-att-src="member.avatarUrl"
                                t-on-click="() => this.onMemberClick(member)"
                        />
                        <i t-else="" class="fa fa-user fa-2x ms-1"/>
                    </div>
                    <div class="flex-grow-1 text-truncate px-3">
                        <div class="text-truncate">
                            <span t-att-class="{'text-primary fw-bold': member.isCurrentUser}" t-out="member.name"/>
                            <span t-if="member.isCurrentUser" class="badge rounded-pill text-bg-primary ms-1">You</span>
                        </div>
                        <div class="text-muted text-truncate">
                            <t t-if="userIsAdmin and member.isCurrentUser">
                                <i class="fa fa-cog pe-1"/><span>Admin</span>
                            </t>
                            <span t-elif="member.partner_share">Guest</span>
                            <t t-if="member.email">
                                <span t-if="member.partner_share or userIsAdmin and member.isCurrentUser" class="mx-1">â€¢</span>
                                <span t-out="member.email" t-att-title="member.email"/>
                            </t>
                        </div>
                        <div t-if="member.based_on" class="text-muted text-truncate">
                            Based on
                            <a href="#" t-on-click="() => this.openArticle(member.based_on)" t-out="member.basedOnName"/>
                        </div>
                    </div>
                    <div class="flex-shrink-0">
                        <Dropdown menuClass="'d-flex flex-column min-w-0'">
                            <button class="btn bg-light border w-100 d-flex align-items-center fw-normal"
                                    t-att-class="{
                                        disabled: !noRightsEscalation and !canEditOtherMember,
                                        'o-dropdown-caret': noRightsEscalation or canEditOtherMember
                                    }" t-out="permissions[member.permission]"
                            />
                            <t t-set-slot="content">
                                <t t-if="!isUniqueWriter and userCanEdit and data.category !== 'private'" t-foreach="permissions" t-as="permission" t-key="permission">
                                    <DropdownItem class="{'flex-grow-1': true, active: permission === member.permission}" onSelected="() => this.selectMemberPermission(member, permission)" t-out="permission_value"/>
                                </t>
                                <hr class="dropdown-divider"/>
                                <DropdownItem onSelected="() => this.removeMember(member)" class="'o_knowledge_permission_panel_remove_member flex-grow-1'">
                                    <t t-if="member.isCurrentUser">Leave</t>
                                    <t t-else="">Remove</t>
                                </DropdownItem>
                            </t>
                        </Dropdown>
                    </div>
                </div>
                <div t-if="userIsAdmin and data.user_permission !== 'write'" class="d-flex align-items-center py-1 my-1 text-muted">
                    <i class="d-flex align-items-center ps-2"><i class="fa fa-cog me-4 pe-1"/>As an administrator, you can always edit this article.</i>
                </div>
            </div>
        </div>
    </t>
</templates>
