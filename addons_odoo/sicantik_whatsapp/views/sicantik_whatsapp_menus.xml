<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    Menu Manajemen WhatsApp untuk SICANTIK
    Menu ini menyediakan akses ke fitur-fitur WhatsApp Business API
    yang digunakan untuk notifikasi perizinan.
    -->

    <!-- Action untuk Partner dengan Opt-In - Didefinisikan terlebih dahulu -->
    <record id="action_res_partner_whatsapp_opt_in" model="ir.actions.act_window">
        <field name="name">Kontak WhatsApp</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">list,form</field>
        <field name="domain">[('phone', '!=', False)]</field>
        <field name="context">{
            'default_is_company': False,
            'search_default_whatsapp_opt_in': 1,
            'default_whatsapp_opt_in': True
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Belum ada kontak WhatsApp
            </p>
            <p>
                Gunakan menu ini untuk mengelola kontak yang telah memberikan izin (opt-in)
                untuk menerima notifikasi WhatsApp.
            </p>
        </field>
    </record>

    <!-- Menu Utama WhatsApp -->
    <menuitem id="menu_sicantik_whatsapp_root"
              name="WhatsApp"
              parent="sicantik_connector.menu_sicantik_root"
              sequence="50"/>

    <!-- Menu Konfigurasi WhatsApp -->
    <menuitem id="menu_sicantik_whatsapp_config"
              name="Konfigurasi"
              parent="menu_sicantik_whatsapp_root"
              sequence="10"/>

    <menuitem id="menu_whatsapp_provider_profiles"
              name="Profil Provider"
              parent="menu_sicantik_whatsapp_config"
              action="sicantik_whatsapp.action_sicantik_whatsapp_provider"
              sequence="5"/>

    <!-- Menu untuk Akun WhatsApp -->
    <menuitem id="menu_whatsapp_accounts"
              name="Akun WhatsApp"
              parent="menu_sicantik_whatsapp_config"
              action="whatsapp.whatsapp_account_action"
              sequence="10"/>

    <!-- Menu untuk Template WhatsApp -->
    <menuitem id="menu_whatsapp_templates"
              name="Template Pesan"
              parent="menu_sicantik_whatsapp_config"
              action="whatsapp.whatsapp_template_action"
              sequence="20"/>
    
    <!-- Menu untuk Master Templates -->
    <menuitem id="menu_whatsapp_template_master"
              name="Master Templates"
              parent="menu_sicantik_whatsapp_config"
              action="action_whatsapp_template_master"
              sequence="25"/>

    <!-- Menu untuk Kelola Opt-In -->
    <menuitem id="menu_sicantik_whatsapp_opt_in"
              name="Manajemen Opt-In"
              parent="menu_sicantik_whatsapp_root"
              sequence="20"/>

    <!-- Menu untuk Export Nomor Telepon -->
    <menuitem id="menu_whatsapp_export_phone_numbers"
              name="Export Nomor Telepon"
              parent="menu_sicantik_whatsapp_opt_in"
              action="action_whatsapp_export_phone_numbers_wizard"
              sequence="10"/>

    <!-- Menu untuk Wizard Cleanup -->
    <menuitem id="menu_sicantik_whatsapp_cleanup"
              name="Pembersihan Data"
              parent="menu_sicantik_whatsapp_opt_in"
              action="action_sicantik_whatsapp_cleanup_wizard"
              sequence="20"/>

    <!-- Menu Monitoring -->
    <menuitem id="menu_sicantik_whatsapp_monitoring"
              name="Pantauan &amp; Laporan"
              parent="menu_sicantik_whatsapp_root"
              sequence="30"/>
    
    <!-- Menu Testing -->
    <menuitem id="menu_test_multi_provider"
              name="ðŸ§ª Test Multi-Provider"
              parent="menu_sicantik_whatsapp_monitoring"
              action="action_test_multi_provider_wizard"
              sequence="5"/>

    <!-- Menu untuk Pesan WhatsApp -->
    <menuitem id="menu_whatsapp_messages"
              name="Riwayat Pesan"
              parent="menu_sicantik_whatsapp_monitoring"
              action="whatsapp.whatsapp_message_action"
              sequence="10"/>

    <!-- Menu untuk Partner dengan Opt-In -->
    <menuitem id="menu_partners_with_whatsapp_opt_in"
              name="Kontak WhatsApp"
              parent="menu_sicantik_whatsapp_monitoring"
              action="action_res_partner_whatsapp_opt_in"
              sequence="20"/>

    <!-- Menu untuk Riwayat Pesan Fonnte/Watzap -->
    <menuitem id="menu_whatsapp_message_log"
              name="Riwayat Pesan (Fonnte/Watzap)"
              parent="menu_sicantik_whatsapp_monitoring"
              action="sicantik_whatsapp.action_whatsapp_message_log"
              sequence="15"/>

    <!-- Filter untuk Partner dengan Opt-In -->
    <record id="filter_res_partner_whatsapp_opt_in" model="ir.filters">
        <field name="name">Kontak dengan Opt-In Aktif</field>
        <field name="model_id">res.partner</field>
        <field name="domain">[('whatsapp_opt_in', '=', True)]</field>
        <field name="is_default" eval="True"/>
    </record>

    <!-- Filter untuk Partner tanpa Opt-In -->
    <record id="filter_res_partner_whatsapp_no_opt_in" model="ir.filters">
        <field name="name">Kontak Belum Opt-In</field>
        <field name="model_id">res.partner</field>
        <field name="domain">[('phone', '!=', False), ('whatsapp_opt_in', '=', False)]</field>
    </record>

    <!-- Action untuk Form Partner dengan Tombol Opt-In - TANPA INHERIT -->
    <!--
        Note: View inherit sementara dinonaktifkan untuk menghindari error
        Jika dibutuhkan, dapat dibuatkan modul terpisah untuk inheritance ini
    -->
</odoo>
